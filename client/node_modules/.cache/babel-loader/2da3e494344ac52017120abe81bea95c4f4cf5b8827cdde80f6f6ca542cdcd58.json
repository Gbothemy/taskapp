{"ast":null,"code":"import _objectSpread from\"C:/Users/HP/Desktop/TPAY/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import axios from'axios';// Create a separate API instance for auth to avoid circular dependency\nconst authApi=axios.create({baseURL:process.env.REACT_APP_API_URL||'http://localhost:5000/api',headers:{'Content-Type':'application/json'}});// Async thunks\nexport const login=createAsyncThunk('auth/login',async(_ref,_ref2)=>{let{email,password}=_ref;let{rejectWithValue}=_ref2;try{const response=await authApi.post('/auth/login',{email,password});const{user,accessToken,refreshToken}=response.data;localStorage.setItem('accessToken',accessToken);localStorage.setItem('refreshToken',refreshToken);return{user,accessToken,refreshToken};}catch(error){var _error$response,_error$response$data;return rejectWithValue(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Login failed');}});export const register=createAsyncThunk('auth/register',async(userData,_ref3)=>{let{rejectWithValue}=_ref3;try{const response=await authApi.post('/auth/register',userData);const{user,accessToken,refreshToken}=response.data;localStorage.setItem('accessToken',accessToken);localStorage.setItem('refreshToken',refreshToken);return{user,accessToken,refreshToken};}catch(error){var _error$response2,_error$response2$data;return rejectWithValue(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Registration failed');}});export const checkAuth=createAsyncThunk('auth/checkAuth',async(_,_ref4)=>{let{rejectWithValue}=_ref4;try{const token=localStorage.getItem('accessToken');if(!token){throw new Error('No token found');}// Add token to the request\nauthApi.defaults.headers.Authorization=\"Bearer \".concat(token);const response=await authApi.get('/auth/me');return response.data.user;}catch(error){localStorage.removeItem('accessToken');localStorage.removeItem('refreshToken');return rejectWithValue('Authentication failed');}});export const refreshToken=createAsyncThunk('auth/refreshToken',async(_,_ref5)=>{let{rejectWithValue}=_ref5;try{const refreshToken=localStorage.getItem('refreshToken');if(!refreshToken){throw new Error('No refresh token found');}const response=await authApi.post('/auth/refresh',{refreshToken});const{accessToken,refreshToken:newRefreshToken}=response.data;localStorage.setItem('accessToken',accessToken);localStorage.setItem('refreshToken',newRefreshToken);return{accessToken,refreshToken:newRefreshToken};}catch(error){localStorage.removeItem('accessToken');localStorage.removeItem('refreshToken');return rejectWithValue('Token refresh failed');}});const initialState={user:null,accessToken:localStorage.getItem('accessToken'),refreshToken:localStorage.getItem('refreshToken'),isAuthenticated:false,loading:false,error:null};const authSlice=createSlice({name:'auth',initialState,reducers:{logout:state=>{state.user=null;state.accessToken=null;state.refreshToken=null;state.isAuthenticated=false;state.error=null;localStorage.removeItem('accessToken');localStorage.removeItem('refreshToken');},clearError:state=>{state.error=null;},updateUser:(state,action)=>{state.user=_objectSpread(_objectSpread({},state.user),action.payload);}},extraReducers:builder=>{builder// Login\n.addCase(login.pending,state=>{state.loading=true;state.error=null;}).addCase(login.fulfilled,(state,action)=>{state.loading=false;state.user=action.payload.user;state.accessToken=action.payload.accessToken;state.refreshToken=action.payload.refreshToken;state.isAuthenticated=true;state.error=null;}).addCase(login.rejected,(state,action)=>{state.loading=false;state.error=action.payload;state.isAuthenticated=false;})// Register\n.addCase(register.pending,state=>{state.loading=true;state.error=null;}).addCase(register.fulfilled,(state,action)=>{state.loading=false;state.user=action.payload.user;state.accessToken=action.payload.accessToken;state.refreshToken=action.payload.refreshToken;state.isAuthenticated=true;state.error=null;}).addCase(register.rejected,(state,action)=>{state.loading=false;state.error=action.payload;state.isAuthenticated=false;})// Check Auth\n.addCase(checkAuth.pending,state=>{state.loading=true;}).addCase(checkAuth.fulfilled,(state,action)=>{state.loading=false;state.user=action.payload;state.isAuthenticated=true;state.error=null;}).addCase(checkAuth.rejected,state=>{state.loading=false;state.isAuthenticated=false;state.user=null;})// Refresh Token\n.addCase(refreshToken.fulfilled,(state,action)=>{state.accessToken=action.payload.accessToken;state.refreshToken=action.payload.refreshToken;}).addCase(refreshToken.rejected,state=>{state.user=null;state.accessToken=null;state.refreshToken=null;state.isAuthenticated=false;});}});export const{logout,clearError,updateUser}=authSlice.actions;export default authSlice.reducer;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}